"use strict";(self.webpackChunkimjuni_home=self.webpackChunkimjuni_home||[]).push([[7420],{4435:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=t(1527),c=t(6274);const r={title:"Async Context",sidebar_position:2},o=void 0,a={id:"backend/node/async_context",title:"Async Context",description:"Background",source:"@site/i18n/ko/docusaurus-plugin-content-docs/current/backend/node/async_context.mdx",sourceDirName:"backend/node",slug:"/backend/node/async_context",permalink:"/imjuni/ko/backend/node/async_context",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Async Context",sidebar_position:2},sidebar:"aboutSidebar",previous:{title:"Design of Entity & DTO",permalink:"/imjuni/ko/backend/node/entity_dto"},next:{title:"JSONSchema",permalink:"/imjuni/ko/opensource/jsonschema/"}},i={},l=[{value:"Background",id:"background",level:2},{value:"Why useful AsyncContext?",id:"why-useful-asynccontext",level:2},{value:"Request ID &amp; Tracking ID",id:"request-id--tracking-id",level:3},{value:"TypeORM with AsyncContext",id:"typeorm-with-asynccontext",level:3},{value:"translate with AsyncContext",id:"translate-with-asynccontext",level:3},{value:"getAsyncStore \ud568\uc218",id:"getasyncstore-\ud568\uc218",level:3},{value:"\uacb0\ub860",id:"\uacb0\ub860",level:2}];function d(n){const e={a:"a",code:"code",h2:"h2",h3:"h3",mermaid:"mermaid",p:"p",pre:"pre",...(0,c.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"background",children:"Background"}),"\n",(0,s.jsxs)(e.p,{children:["\uc774 \ubb38\uc11c\ub294 AsyncContext \uae30\ub2a5\uc744 \uc18c\uac1c\ud569\ub2c8\ub2e4. ",(0,s.jsx)(e.a,{href:"https://github.com/tc39/proposal-async-context",children:"AsyncContext"}),"\ub294 TC39 ",(0,s.jsx)(e.a,{href:"https://tc39.es/process-document/",children:"Stage2"})," \ub2e8\uacc4\uc5d0 \uc788\ub294 \uae30\ub2a5\uc785\ub2c8\ub2e4. Node.js \ud658\uacbd\uc5d0\uc11c\ub294 v12\ubd80\ud130 \ud3ec\ud568\ub418\uc5b4 \uc788\uc5c8\uace0 v14 ~ v20 \ub4f1\uc758 \ubc84\uc804\uc5d0\uc11c \uc548\uc815\uc801\uc73c\ub85c \ub3d9\uc791\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc18c\uac1c\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.p,{children:"\ub3d9\uae30\uc2dd \ud568\uc218\ub97c \uc2e4\ud589\ud560 \ub54c\ub294 \ud568\uc218\ub97c \uc2e4\ud589\ud558\uae30 \uc804 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc0dd\uc131\ud558\uba74 \ud568\uc218\uac00 \uc2e4\ud589\ud558\ub294 \ub3d9\uc548 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc720\uc9c0\ud558\uace0 \ud65c\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub3d9\uae30\uc2dd \ud568\uc218\ub294 \uc2e4\ud589\ub418\ub294 \ub3d9\uc548 \ub2e4\ub978 \ud568\uc218\uac00 \uc2e4\ud589\ub418\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc2e4\ud589 \ud568\uc218\uac00 \ubcc0\uacbd\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 \uac12\uc744 \ubcf4\uc7a5\ud560 \uc218 \uc788\uc5b4\uc11c \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud65c\uc6a9\ud560 \uc218 \uc788\uc9c0\ub9cc \ube44\ub3d9\uae30\uc2dd \ud568\uc218\ub294 \ub2e4\ub978 \ud568\uc218\uac00 \uc2e4\ud589\ub420 \uc218 \uc788\uc5b4\uc11c \ucee8\ud14d\uc2a4\ud2b8 \uac12\uc744 \ubcf4\uc7a5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c \ucd94\uc801\uc744 \uc704\ud55c tracking id, request id \ub4f1\uc758 \uac12\uc774\ub098 language, cache life cycle \ub4f1\uc758 \uc124\uc815\uc744 \ud568\uc218\uc758 \uc778\uc790\ub85c \uacc4\uc18d \uc804\ub2ec \ud574\uc57c\ud558\ub294 \ubd88\ud3b8\ud568\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"function child01(lang: string) {\n\treturn translate('greeting', { lang });\n}\n\nfunction child02(lang: string) {\n\treturn { message: child01(lang) };\n}\nfunction child03(lang: string) {\n\treturn child02(lang);\n}\nfunction child04(lang: string) {\n\treturn child03();\n}\nfunction child05(lang: string) {\n\treturn child04(lang);\n}\n\nfunction parent(req: FastifyRequest) {\n  const lang = req.headers['accpet-language'];\n\tconst message = child05(lang);\n\treturn { ...message, id: 1 };\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uc704 \uc608\uc81c\ub97c \ubcf4\uba74 parent \ud568\uc218\ub294 child05 \ud568\uc218\ub97c \uc0ac\uc6a9\ud574\uc11c \uba54\uc2dc\uc9c0 \uac12\uc744 \uc5bb\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \uc2e4\uc81c\ub85c child05\ud568\uc218\ub294 \uc5ec\ub7ec\ucc28\ub840 \ub2e4\ub978 \ud568\uc218\ub97c \uc2e4\ud589\ud574\uc11c \uba54\uc2dc\uc9c0\ub97c \uc5bb\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.mermaid,{value:'---\ntitle: \ud568\uc218 \uc2e4\ud589 \ub2e8\uacc4\n---\nflowchart LR\n    P01["parent(req)"] --\x3e C05["child05(lang)"]\n    C05 --\x3e |lang| C04["child04(lang)"]\n    C04 --\x3e |lang| C03["child03(lang)"]\n    C03 --\x3e |lang| C02["child02(lang)"]\n    C02 --\x3e |lang| C01["child01(lang)"]\n    C01 -.-> C02\n    C02 -.-> C03\n    C03 -.-> C04\n    C04 -.-> C05\n    C05 -.-> P01'}),"\n",(0,s.jsx)(e.p,{children:"\uc704 \uc608\uc81c \ucf54\ub4dc\uc5d0\uc11c child02, child03, child04, child05\ub294 \uc5b8\uc5b4\uc640 \uad00\ub828\ud55c \ubcc4\ub3c4\uc758 \uc791\uc5c5\uc744 \ud558\uc9c0\ub294 \uc54a\uc9c0\ub9cc child01 \ud568\uc218\uc5d0 \uc5b8\uc5b4 \uac12\uc744 \uc804\ub2ec\ud558\uae30 \uc704\ud574\uc11c lang \uac12\uc744 \uacc4\uc18d \uc778\uc790\ub85c \uc804\ub2ec \ubc1b\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud65c\uc6a9\ud558\uba74 \uc774\ub7f0 \uad6c\uc870\ub97c \uac04\ub2e8\ud558\uac8c \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const { AsyncLocalStorage, AsyncResource } = require('async_hooks');\nconst store = new AsyncLocalStorage();\nconst Polyglot = require('node-polyglot');\n\nconst polyglot = {\n  ko: new Polyglot({\n    phrases: {\n      hello_name: '\uc548\ub155\ud558\uc138\uc694! %{name}\ub2d8',\n    },\n  }),\n  en: new Polyglot({\n    phrases: {\n      hello_name: 'Hola %{name}',\n    },\n  }),\n};\n\nasync function child01() {\n  const currentStore = store.getStore();\n  console.log('language: ', currentStore.lang);\n  return polyglot[currentStore.lang].t('hello_name', { name: 'hello' });\n}\n\nasync function child02() {\n  return { message: await child01() };\n}\nasync function child03() {\n  return child02();\n}\nasync function child04() {\n  return child03();\n}\nasync function child05() {\n  return child04();\n}\n\nasync function parent(req) {\n  const lang = req.headers['accpet-language'];\n\n  const result = store.run({ lang }, async () => {\n    const resource = new AsyncResource('fastify-async-context');\n    return resource.runInAsyncScope(async () => {\n      const message = await child05(lang);\n      return { ...message, id: 1 };\n    });\n  });\n\n  return result;\n}\n\nasync function handler() {\n  const r = await parent({ headers: { 'accpet-language': 'en' } });\n  console.log(r);\n}\n\nhandler().catch((err) => {\n  console.log(err.message);\n});\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uc774 \uc608\uc81c\ub294 \uc774\uc804\uacfc \ub2e4\ub974\uac8c child01 ~ child05 \ud568\uc218\uc5d0 \ubcc4\ub3c4\ub85c lang \uac12\uc744 \uc778\uc790\ub85c \uc804\ub2ec\ud558\uc9c0 \uc54a\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc778\uc790\ub85c \uc804\ub2ec\ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 child01 \ud568\uc218\uc5d0\uc11c AsyncContext\ub97c \uc0ac\uc6a9\ud574\uc11c \uc5b8\uc5b4 \uac12\uc744 \uc77d\uc5b4 \uc624\ub294 \uac83\uc744 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.mermaid,{value:'---\ntitle: \ud568\uc218 \uc2e4\ud589 \ub2e8\uacc4\n---\nflowchart LR\n    P01["parent(req)"] --\x3e C05["child05(lang)"]\n    P01 --\x3e |lang| S01[AsyncLocaStorage]\n    C05 --\x3e C04["child04(lang)"]\n    C04 --\x3e C03["child03(lang)"]\n    C03 --\x3e C02["child02(lang)"]\n    C02 --\x3e C01["child01(lang)"]\n    S01 --\x3e |lang| C01\n    C01 -.-> C02\n    C02 -.-> C03\n    C03 -.-> C04\n    C04 -.-> C05\n    C05 -.-> P01'}),"\n",(0,s.jsx)(e.p,{children:"\uc774\uc640 \uac19\uc774 AsyncContext\ub97c \ud65c\uc6a9\ud558\uba74 \uc0dd\uc0b0\uc131\uc744 \ub192\uc77c \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.h2,{id:"why-useful-asynccontext",children:"Why useful AsyncContext?"}),"\n",(0,s.jsxs)(e.p,{children:["\ubc30\uacbd \uc124\uba85\uc5d0\uc11c \uc65c \uc720\uc6a9\ud55c\uc9c0\ub97c \uc124\uba85\ud588\uace0, \uc774\uc81c \uc6b0\ub9ac\ub294 AsyncContext\uac00 \uc720\uc6a9\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc744 \uc54c\uc558\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c \uc774\ubc88\uc5d0\ub294 \uc81c\uac00 \uc815\ub9d0 \uc720\uc6a9\ud558\uac8c \uc0ac\uc6a9\ud588\ub358 \uacbd\ud5d8\uc744 \uc880 \ub354 \uc0c1\uc138\ud558\uac8c \uc124\uba85\ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \ub2e4\ub9cc \uc544\uc9c1 \ube0c\ub77c\uc6b0\uc800\ub294 AsyncContext\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uadf8\ub798\uc11c ",(0,s.jsx)(e.a,{href:"https://www.npmjs.com/package/zone.js",children:"zone.js"}),"\uc640 \uac19\uc740 \ub300\uc548\uc744 \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4. \uadf8\ub798\uc11c Node.js \ud658\uacbd\uc5d0\uc11c AsyncContext\ub97c \uc5b4\ub5bb\uac8c \ud65c\uc6a9\ud560 \uc218 \uc788\ub294\uc9c0 \uc54c\uc544\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.h3,{id:"request-id--tracking-id",children:"Request ID & Tracking ID"}),"\n",(0,s.jsx)(e.p,{children:"\ubaa8\ub4e0 Request\uc5d0 \uace0\uc720\ud55c ID\ub97c \ubd80\uc5ec\ud558\ub294 \uac83\uc740 \uc7a5\uc560, \ubc84\uadf8 \ub4f1\uc774 \ubc1c\uc0dd\ud588\uc744 \ub54c \ubb38\uc81c\ub97c \ubd84\uc11d\ud558\ub294\ub370 \uc720\uc6a9\ud569\ub2c8\ub2e4. fastify.js\ub294 Request ID\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const tidSymbol = Symbol('tid')\nconst fastify = require('fastify');\nconst server = fastify({ genReqId: (req) => {\n\tconst tid = randomUUID();\n\treq[tidSymbol] = tid;\n\treturn tid;\n} });\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uc774\uc81c request\uc5d0 \uace0\uc720\ud55c UUID\uac00 \ubd80\uc5ec\ub418\uace0 \uc774 UUID\ub97c \uc5bb\uc73c\uba74 request\ub97c \ucd94\uc801\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc880 \ub354 \uc720\uc6a9\ud558\uac8c \ub9cc\ub4e4\uc5b4 \ubd05\uc2dc\ub2e4. \ucc98\uc74c \ud560 \uc77c\uc740 randomUUID() \uacb0\uacfc\ub85c \uc5bb\uc740 Request ID\ub97c AsyncContext\uc5d0 \uc800\uc7a5\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"const fastify = require('fastify');\nconst { AsyncResource, executionAsyncId } = require('async_hooks');\nconst  { fastifyRequestContext } = require('@fastify/request-context');\nconst crypto = require('crypto');\n\nconst tidSymbol = Symbol('fastify-request-context-tracking-id')\nconst resourceType = 'fastify-request-context';\n\n// Server\ub97c \uc0dd\uc131, Request ID\ub97c crypto.randomUUID\ub85c \uc0dd\uc131\nconst server = fastify({ \n  genReqId: (req) => {\n    const tid = crypto.randomUUID();\n    req[tidSymbol] = tid;\n    return tid;\n  } \n});\n\nserver.register(fastifyRequestContext, {\n  defaultStoreValues: (req) => ({\n    tid: req.id,\n    lang: req.headers['accept-language'],\n    type: resourceType,\n    triggerAsyncId: executionAsyncId(),\n  }),\n  createAsyncResource: () => new AsyncResource(resourceType),\n});\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uc774\uc81c \ubaa8\ub4e0 Request Handler\uc5d0\uc11c request.id\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\uace0, \ub2e4\ub978 \ud568\uc218\uc5d0\uc11c\ub3c4 AsyncContext\ub97c \uc0ac\uc6a9\ud574\uc11c Request ID\ub97c \ucd94\ucd9c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.h3,{id:"typeorm-with-asynccontext",children:"TypeORM with AsyncContext"}),"\n",(0,s.jsx)(e.p,{children:"TypeORM\uc740 \uc5ec\ub7ec\uac00\uc9c0 \ub370\uc774\ud130\ubca0\uc774\uc2a4\ub97c Node.js \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ud574\uc8fc\ub294 \ub77c\uc774\ube0c\ub7ec\ub9ac\uc785\ub2c8\ub2e4. ORM \ub77c\uc774\ube0c\ub7ec\ub9ac\ub294 \uc2e4\ud589\ud55c \ucffc\ub9ac\ub97c \ub85c\uae45\ud558\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. TypeORM\ub3c4 \ubaa8\ub4e0 \ucffc\ub9ac, \uc2ac\ub85c\uc6b0 \ucffc\ub9ac, \ucffc\ub9ac \uc624\ub958 \ub4f1\uc744 \ub85c\uae45\ud560 \uc218 \uc788\ub294 \uae30\ub2a5\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4. \ub85c\uae45 \uae30\ub2a5\uc744 \uc55e\uc11c \uc5b8\uae09\ud55c Request ID\uc640 \uc5f0\uacb0\ud558\uba74 \uc720\uc6a9\ud55c \ub85c\uadf8\uac00 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import { AbstractLogger } from \"typeorm\"\n\nexport class MyCustomLogger extends AbstractLogger {\n  /**\n   * Write log to specific output.\n  */\n  protected writeLog(\n        level: LogLevel,\n        logMessage: LogMessage | LogMessage[],\n        queryRunner?: QueryRunner,\n    ) {\n        // implementation of writeLog ...\n\t}\n\t\n\t/**\n   * Logs query that is slow.\n   */\n  logQuerySlow(time: number, query: string, parameters?: unknown[], _queryRunner?: QueryRunner) {\n    if (isFalse(this.isLogEnabledFor('query-slow'))) {\n      return;\n    }\n\n\t  const store = getAsyncStore();\n\t  console.log(`[${store.tid ?? randomUUID()}][${time}]show query: `, query, parameters);\n  }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uc704 \uc608\uc81c\ub294 \uc2ac\ub85c\uc6b0 \ucffc\ub9ac\uc640 tid\ub97c \uac19\uc774 \uae30\ub85d\ud569\ub2c8\ub2e4. \uc774\ub807\uac8c\ud558\uba74 \uc5b4\ub5a4 API\uc5d0\uc11c \uc2ac\ub85c\uc6b0 \ucffc\ub9ac\uac00 \ubc1c\uc0dd\ud588\ub294\uc9c0 \ube60\ub974\uac8c \ucd94\uc801\uc774 \uac00\ub2a5\ud558\uba70 API \ud638\ucd9c \ube48\ub3c4\ub97c \ud30c\uc545\ud574\uc11c \uc218\uc815 \uacc4\ud68d\uc744 \uc138\uc6b8 \ub54c \uc720\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.h3,{id:"translate-with-asynccontext",children:"translate with AsyncContext"}),"\n",(0,s.jsx)(e.p,{children:"\ub2e4\uad6d\uc5b4 \uba54\uc2dc\uc9c0\ub97c \ub9cc\ub4e4\ub54c i18n \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc800\ub294 node-polyglot\ub97c \uc0ac\uc6a9\ud558\ub294\ub370, translate \ud568\uc218\ub97c \uc0ac\uc6a9\ud558\uae30 \uc804\uc5d0 \uc0ac\uc6a9\ud560 \uc5b8\uc5b4\ub97c \uacb0\uc815\ud574\uc57c\ud569\ub2c8\ub2e4. \uc5b8\uc5b4\ub97c \uacb0\uc815\ud558\ub824\uba74 \uc55e\uc11c \ubc30\uacbd\uc124\uba85\uc5d0\uc11c \uc5b8\uae09\ud55c \uac83\uacfc \uac19\uc774 \uc5b8\uc5b4\ub97c \uc5ec\ub7ec \ud568\uc218\uc5d0 \uacc4\uc18d \uc804\ub2ec\ud574\uc57c \ud558\ub294\ub370 \uc774 \ub54c AsyncContext\ub97c \uc0ac\uc6a9\ud558\uba74 \uadf8\ub7f0 \uacfc\uc815\uc744 \uac04\uc18c\ud654 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.h3,{id:"getasyncstore-\ud568\uc218",children:"getAsyncStore \ud568\uc218"}),"\n",(0,s.jsxs)(e.p,{children:["AsyncContext\ub97c \uc0ac\uc6a9\ud588\uc744 \ub54c \uc720\uc6a9\ud55c \uc0c1\ud669\uc744 \ubcfc \uc218 \uc788\uc5c8\uc2b5\ub2c8\ub2e4. \uadf8\ub807\ub2e4\uba74 AsyncLocalStorage\ub97c \uc5b4\ub5bb\uac8c \uc5bb\uc744 \uc218 \uc788\ub294\uc9c0 \uc54c\uc544\ubd05\uc2dc\ub2e4. AsyncLocalStorage\ub97c \uc5bb\uc744 \uc218 \uc788\ub294 \ubc29\ubc95\uc740 \ub450 \uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uccab \ubc88\uc9f8 \ubc29\ubc95\uc740 Hook\uc744 \uc0ac\uc6a9\ud558\uc5ec AsyncResource\uac00 \uc0dd\uc131, \uc18c\uba78 \ub420 \ub54c \uc0ac\ubcf8\uc744 \uc0dd\uc131\ud574\uc11c \uc5bb\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4. \uc774 \ubc29\ubc95\uc740 ",(0,s.jsx)(e.a,{href:"https://blog.besson.co/nodejs_async_hooks_to_get_per_request_context/",children:"Getting per-request context in NodeJS with async_hooks\n"}),"\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub450 \ubc88\uc9f8 \ubc29\ubc95\uc740 ",(0,s.jsx)(e.code,{children:"executionAsyncResource"}),"\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"import { executionAsyncResource } from 'node:async_hooks';\nimport { randomUUID } from 'node:crypto';\n\nexport function getAsyncStore(): { [key: string]: unknown } {\n  const acquiredExecutionAsyncResource = executionAsyncResource() as {\n    [key: string | symbol]: unknown;\n  };\n  const keys = Object.getOwnPropertySymbols(acquiredExecutionAsyncResource);\n  const store = keys\n    .map((key) => acquiredExecutionAsyncResource[key])\n    .find((element): element is { tid: string } => typeof element === 'object' && element != null);\n\n  if (store?.tid == null) {\n    return `unde${randomUUID().substring(4)}`;\n  }\n\n  return store.tid;\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Object.getOwnPropertySymbols"})," \ud568\uc218\ub97c \uc0ac\uc6a9\ud558\uba74 AsyncResource\uc758 \ud0a4\ub97c \ucd94\ucd9c\ud560 \uc218 \uc788\uace0, \uc774 \ubc29\ubc95\uc73c\ub85c AsyncLocalStorage\ub97c \uc5bb\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc5b4\ub5a4 \ubc29\uc2dd\uc744 \uc120\ud0dd\ud558\ub358 \uc0c1\uad00 \uc5c6\uc9c0\ub9cc \uac1c\uc778\uc801 \uacbd\ud5d8\uc73c\ub85c\ub294 \uccab \ubc88\uc9f8 \ubc29\ubc95\uc740 \uac04\ud639 AsyncLocalStorage\ub97c \uac80\uc0c9\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0\uac00 \uc788\uc5b4\uc11c \ud56d\uc0c1 \uc798 \ub3d9\uc791\ud558\ub294 \uacbd\uc6b0\ub97c \uc6d0\ud55c\ub2e4\uba74 \ub450 \ubc88\uc9f8 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \ucd94\ucc9c\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.h2,{id:"\uacb0\ub860",children:"\uacb0\ub860"}),"\n",(0,s.jsxs)(e.p,{children:["AsyncContext\ub294 \uc544\uc9c1 Stage2 \ub2e8\uacc4\uc5d0 \uc788\uace0, Node.js \uacf5\uc2dd ",(0,s.jsx)(e.a,{href:"https://nodejs.org/api/async_hooks.html",children:"\ub808\ud37c\ub7f0\uc2a4 \ubb38\uc11c"}),"\ub97c \ubcf4\uba74 \ubc84\uc804 \ubcc4\ub85c \uad6c\ud604\ud55c \ub0b4\uc6a9\uc774 \uc870\uae08\uc529 \ub2e4\ub985\ub2c8\ub2e4. \uadf8\ub798\uc11c Node.js v16 \ubbf8\ub9cc\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc0ac\uc6a9\ud558\uae30 \uc5b4\ub824\uc6b8 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub610\ud55c Stage2 \ub2e8\uacc4\uc774\uae30 \ub54c\ubb38\uc5d0 \uc2a4\ud399\uc774 \ubcc0\uacbd\ub420 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7fc\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 AsyncContext\ub294 \ub9e4\ub825\uc801\uc785\ub2c8\ub2e4. \ucd5c\uadfc fastify.js, express.js\uc758 function handler \ub610\ub294 RabbitMQ, ActiveMQ, SQS\ub97c \uc0ac\uc6a9\ud560 \ub54c producer, comsumer \ub4f1\uc740 \ube44\ub3d9\uae30 \ud568\uc218\ub85c \uc791\uc131\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc544\uc11c AsyncContext\ub97c \ud65c\uc6a9\ud558\uae30 \uc88b\uc544\uc84c\uc2b5\ub2c8\ub2e4. \ud2b9\ud788 Message Queue\ub97c \uc0ac\uc6a9\ud560 \ub54c \uba54\uc2dc\uc9c0\ub098 \uc791\uc5c5\ud558\ub294 \uc791\uc5c5 \uacfc\uc815\uc5d0 UUID\ub97c \ubd80\uc5ec\ud574\uc11c \ub85c\uadf8\uc5d0 \uae30\ub85d\ud55c\ub2e4\uba74 \uc5ed\uc2dc \uc720\uc6a9\ud55c \ub85c\uadf8\ub97c \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ud568\uc218\uc758 \uc778\uc790\ub97c \uc77c\uc77c\ud788 \ucd94\uac00\ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 \uacf5\ud1b5\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uac12\uc744 \uc5b4\ub518\uac00\uc5d0\uc11c \uc5bb\uc5b4\uc62c \uc218 \uc788\ub2e4\ub294 \uac83\uc740 \ub9e4\uc6b0 \uc720\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uc0c8\ub85c\uc6b4 \ud658\uacbd\uc744 \uad6c\ucd95\ud55c\ub2e4\uac70\ub098 v16 \uc774\uc0c1\uc758 Node.js\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4\uba74 \uaf2d \ud55c \ubc88 \uac80\ud1a0\ud574\ubcf4\uc138\uc694. \uac10\uc0ac\ud569\ub2c8\ub2e4."]})]})}function u(n={}){const{wrapper:e}={...(0,c.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}}}]);