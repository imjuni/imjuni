<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-typescript/library" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">In-Depth guide for TypeScript Library Project | imjuni</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://imjuni.github.io/imjuni/typescript/library"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ko"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="In-Depth guide for TypeScript Library Project | imjuni"><meta data-rh="true" name="description" content="Background"><meta data-rh="true" property="og:description" content="Background"><link data-rh="true" rel="icon" href="/imjuni/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://imjuni.github.io/imjuni/typescript/library"><link data-rh="true" rel="alternate" href="https://imjuni.github.io/imjuni/typescript/library" hreflang="en"><link data-rh="true" rel="alternate" href="https://imjuni.github.io/imjuni/ko/typescript/library" hreflang="ko"><link data-rh="true" rel="alternate" href="https://imjuni.github.io/imjuni/typescript/library" hreflang="x-default"><link rel="stylesheet" href="/imjuni/assets/css/styles.f6402a44.css">
<script src="/imjuni/assets/js/runtime~main.492430c1.js" defer="defer"></script>
<script src="/imjuni/assets/js/main.5d7ac03d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XIrk" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/imjuni/"><b class="navbar__title text--truncate">imjuni</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/imjuni/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/imjuni" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mtdL"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dM09"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/imjuni/typescript/library" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/imjuni/ko/typescript/library" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ko">한국어</a></li></ul></div><div class="toggle_HCq0 colorModeToggle_TBa1"><button class="clean-btn toggleButton_mV3c toggleButtonDisabled_gPVl" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ulA6"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_jfS4"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_rBGs"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_j166"><div class="docsWrapper_WccV"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_zNLY" type="button"></button><div class="docRoot_pxTM"><aside class="theme-doc-sidebar-container docSidebarContainer_f0K6"><div class="sidebarViewport_VW25"><div class="sidebar_gUGL"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_owLA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/imjuni/">About</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/imjuni/resume/">Resume</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/imjuni/backend/">Backend</a><button aria-label="Expand sidebar category &#x27;Backend&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/imjuni/opensource/jsonschema/">OpenSources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/imjuni/typescript/ctix">TypeScript</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/imjuni/typescript/ctix">ctix - barrel file generator using TypeScript Compiler API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/imjuni/typescript/library">In-Depth guide for TypeScript Library Project</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_Mfgp"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_l2wo"><div class="docItemContainer_M9ev"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_wxjA" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/imjuni/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_eUt2"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TypeScript</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">In-Depth guide for TypeScript Library Project</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_w28O theme-doc-toc-mobile tocMobile_k8pe"><button type="button" class="clean-btn tocCollapsibleButton_kVUG">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>In-Depth guide for TypeScript Library Project</h1></header><h2 class="anchor anchorWithStickyNavbar_awSM" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>It&#x27;s a common approach in development projects to separate common business logic into functions or classes within the same project for reuse. As a project grows in size, some logic may be more efficiently isolated into separate packages and used in other projects. In my experience, functions like login, logout, and logging are easier to maintain and adapt in the long run if they are separated into separate library packages. I&#x27;ve reviewed several articles on writing library packages, but here I&#x27;m going to summarize some of the more specialized topics that aren&#x27;t covered in those articles.</p>
<h2 class="anchor anchorWithStickyNavbar_awSM" id="whats-the-problem">What&#x27;s the problem?<a href="#whats-the-problem" class="hash-link" aria-label="Direct link to What&#x27;s the problem?" title="Direct link to What&#x27;s the problem?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="barrel-file-edit-over-and-over-again">Barrel file, edit over and over again<a href="#barrel-file-edit-over-and-over-again" class="hash-link" aria-label="Direct link to Barrel file, edit over and over again" title="Direct link to Barrel file, edit over and over again">​</a></h3>
<p>To simplify the <code>import</code> syntax, the file that holds the <code>export</code> syntax is called a <a href="https://basarat.gitbook.io/typescript/main-1/barrel" target="_blank" rel="noopener noreferrer">barrel file</a>.</p>
<blockquote>
<p>barrel file</p>
</blockquote>
<div class="language-ts codeBlockContainer_RXBV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_wPkZ"><pre tabindex="0" class="prism-code language-ts codeBlock_KKOe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_B95v"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Button </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./button/index.ts&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Accordion </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./accordion/index.ts&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Notification </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./notification/index.ts&#x27;</span><br></span></code></pre><div class="buttonGroup_V0Br"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_KMRO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_D2ly"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_sKd7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>other file</p>
</blockquote>
<div class="language-ts codeBlockContainer_RXBV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_wPkZ"><pre tabindex="0" class="prism-code language-ts codeBlock_KKOe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_B95v"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> Button </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;../../src&#x27;</span><br></span></code></pre><div class="buttonGroup_V0Br"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_KMRO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_D2ly"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_sKd7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Barrel files are commonly found in component library projects. For example, you can find a <a href="https://github.com/mantinedev/ui.mantine.dev/blob/master/lib/index.ts" target="_blank" rel="noopener noreferrer">Barrel file</a> in the <a href="https://github.com/mantinedev/ui.mantine.dev" target="_blank" rel="noopener noreferrer">Mantine</a> project. Since there are often no dependencies between each component or feature in a library project, it often happens that the bundler does not include all the files even when using a dependency graph. This is where the barrel file comes into handy. By specifying the barrel file in the main and module fields of the <code>package.json</code> file, it also serves as a point of execution for the Node.js interpreter or the browser&#x27;s script tag. Barrel files are often written by developers themselves because they fulfill an important function.</p>
<p>However, it is a big challenge for developers to write barrel files themselves. In projects like <a href="https://github.com/mantinedev/ui.mantine.dev" target="_blank" rel="noopener noreferrer">Mantine</a> and <a href="https://github.com/date-fns/date-fns" target="_blank" rel="noopener noreferrer">date-fns</a>, which are already very large, it is not easy to write a barrel file every time there is a change, and if it is included in a VCS(e.g. <code>git</code>), it increases the probability of conflicts when multiple developers collaborate. Therefore, I thought there is a need for a way to automatically generate barrel files based on certain rules and not include them in a VCS.</p>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="can-i-use-paths-re-maps">Can I use paths re-maps?<a href="#can-i-use-paths-re-maps" class="hash-link" aria-label="Direct link to Can I use paths re-maps?" title="Direct link to Can I use paths re-maps?">​</a></h3>
<p>To import classes, functions, constants, etc. from another script in TypeScript and JavaScript, you need to enter the relative path to the script you want to call from the current script.</p>
<div class="language-ts codeBlockContainer_RXBV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_wPkZ"><pre tabindex="0" class="prism-code language-ts codeBlock_KKOe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_B95v"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> chunkArray </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;../../tools/array/chunkArray&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBulkInsertFruit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fruits</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">chunkArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fruits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_V0Br"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_KMRO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_D2ly"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_sKd7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example code above, you can see that we imported the function with a relative path. Using relative paths is inconvenient because the import statement is always different. Using a barrel file doesn&#x27;t improve things much, and it&#x27;s a difficult problem to solve without the help of an IDE. That&#x27;s why TypeScript provides the <a href="https://www.typescriptlang.org/tsconfig#paths" target="_blank" rel="noopener noreferrer">Paths Re-Map</a> feature.</p>
<div class="language-ts codeBlockContainer_RXBV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_wPkZ"><pre tabindex="0" class="prism-code language-ts codeBlock_KKOe thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_B95v"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> chunkArray </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#/tools/array/chunkArray&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBulkInsertFruit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fruits</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">chunkArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fruits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_V0Br"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_KMRO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_D2ly"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_sKd7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you look at the example code above, you can see that we&#x27;ve imported the <code>chunkArray</code> function as if we were using an absolute path. This feature allows you to use the same import statement for all your files and reduces the amount of work when refactoring to change paths or filenames. However, since this feature is not provided by ECMA Script, it creates a number of problems: not only do you have to tell your test frameworks like jest and vitest to set up Paths Re-Map, but you also have to tell your bundlers about it. It also affects the bundling of <code>.d.ts</code> files, which we will discuss in the next chapter. Since this issue is the same for library packages and applications alike, we also need a way to work around it.</p>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="bundling-for-dts">bundling for <code>.d.ts</code><a href="#bundling-for-dts" class="hash-link" aria-label="Direct link to bundling-for-dts" title="Direct link to bundling-for-dts">​</a></h3>
<p>In order for a TypeScript-based library package to be used by other TypeScript projects, it is necessary to provide the type files (.d.ts) along with the JavaScript files. To do this, the <code>types</code> field in the <code>package.json</code> file sets the entry point for the type files. However, there is no official way to effectively bundle type files. There was a <a href="https://github.com/Microsoft/TypeScript/issues/4433" target="_blank" rel="noopener noreferrer">discussion</a> about this, but the issue was closed without a clear solution to the problem.</p>
<p>Using TypeScript&#x27;s Paths Re-Map feature further complicates matters. TypeScript has <a href="https://github.com/microsoft/TypeScript/issues/5039" target="_blank" rel="noopener noreferrer">defined module renaming for Paths Re-Mapped modules as the role of the bundler</a>, which means that when using Paths Re-Map, providing a type file requires you to do two things: convert the Paths Re-Map of that type file to a relative path and bundle it. This can make it difficult for library package developers to efficiently manage and ship type files.</p>
<h2 class="anchor anchorWithStickyNavbar_awSM" id="how-can-we-solve-it">How can we solve it?<a href="#how-can-we-solve-it" class="hash-link" aria-label="Direct link to How can we solve it?" title="Direct link to How can we solve it?">​</a></h2>
<p>If you don&#x27;t use bundlers and Paths Re-Map, you can avoid the issues involved. However, you&#x27;ll still need to manually write your barrel files, and as your library package grows in size, it can be inefficient to use only the basic functionality. So, let&#x27;s take a look at how you can solve the problem.</p>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="automatically-generate-a-barrel-file">Automatically generate a barrel file<a href="#automatically-generate-a-barrel-file" class="hash-link" aria-label="Direct link to Automatically generate a barrel file" title="Direct link to Automatically generate a barrel file">​</a></h3>
<p>I&#x27;ve been working on automating barrel files for a long time, and in the process have developed <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a>. The 1.x version had some inconveniences, but with the 2.x version, I&#x27;ve improved these issues and made it more user-friendly. ctix uses the TypeScript Compiler API to automatically generate barrel files by extracting statements containing the <code>export</code> keyword. The advantage of ctix is that barrel files are automatically generated, so you don&#x27;t have to manage them separately in your version control system (VCS), e.g. git. It also has the advantage of always generating compilable barrel files because it uses the TypeScript Compiler API to extract only <code>export</code> statements.</p>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="dts-bundling"><code>.d.ts</code> bundling<a href="#dts-bundling" class="hash-link" aria-label="Direct link to dts-bundling" title="Direct link to dts-bundling">​</a></h3>
<p>This is a really hard problem. For now, there are <a href="https://github.com/Microsoft/TypeScript/issues/4433" target="_blank" rel="noopener noreferrer">discussions</a> going on within the TypeScript community to resolve this issue, but they are inconclusive, and have been for a long time. So we need to use external tools to solve this problem. Currently, the popular <code>.d.ts</code> bundling tools are as follows</p>
<ul>
<li><a href="https://api-extractor.com/" target="_blank" rel="noopener noreferrer">API Extractor</a></li>
<li><a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a></li>
<li><a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a></li>
<li><a href="https://github.com/wessberg/rollup-plugin-ts" target="_blank" rel="noopener noreferrer">rollup-plugin-ts</a></li>
<li><a href="https://github.com/jeremyben/tsc-prog" target="_blank" rel="noopener noreferrer">tsc-prog</a></li>
</ul>
<p>There are many more tools than those listed above. You can check out <a href="https://github.com/Microsoft/TypeScript/issues/4433" target="_blank" rel="noopener noreferrer">discussion</a> and <a href="https://github.com/timocov/dts-bundle-generator/discussions/68" target="_blank" rel="noopener noreferrer">comparison</a> of bundling tools. Unfortunately, choosing the right tool among them is a process that you&#x27;ll have to experiment with and decide for your own project needs. For example, <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a>, <a href="https://api-extractor.com/" target="_blank" rel="noopener noreferrer">API Extractor</a>, and <a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a> do not support <code>.d.ts.map</code> files. Also, <a href="https://api-extractor.com/" target="_blank" rel="noopener noreferrer">API Extractor</a> and <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a> do not have chunking capabilities, <a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a> is currently in maintenance mode, and the <code>default export</code> and <code>export</code> statements differ in the way different bundlers generate output. Therefore, you should carefully select and use the most appropriate tool based on your project&#x27;s configuration.</p>
<p>The <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a> is a lightweight and easy tool. If you pass a barrel file generated using <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a> to <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a> and just specify the path to the output file, it will work fine in most cases without any additional setup. However, if you are using the latest version of <a href="https://fastify.dev/" target="_blank" rel="noopener noreferrer">Fastify.js</a> in your backend development, you may encounter an issue where bundling fails because <code>Symbol.asyncDispose</code> is not found. This is due to the way the <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noopener noreferrer">dts-bundle-generator</a> loads only necessary modules for performance optimization, which prevents it from loading some <code>.d.ts</code> files. There is a <a href="https://github.com/timocov/dts-bundle-generator/discussions/232" target="_blank" rel="noopener noreferrer">workaround</a> being discussed for this, but it didn&#x27;t work in my case. Nevertheless, the tool generally works well and is easy to use with a few simple option settings, and I recommend testing in a live environment if you are considering adopting it.</p>
<p>The <a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a> is a plugin that is currently in maintenance mode, but still works well. However, this plugin only performs bundling correctly for <code>.d.ts</code> files that do not use Paths Re-Map. By the way, even if you create a <code>.d.ts</code> file using <a href="https://github.com/rollup/plugins/tree/master/packages/typescript" target="_blank" rel="noopener noreferrer">@rollup/plugin-typescript</a>, this does not fully resolve Paths Re-Map. For this, you need to use <a href="https://github.com/justkey007/tsc-alias" target="_blank" rel="noopener noreferrer">tsc-alias</a> to resolve Paths Re-Map issues. After resolving Paths Re-Map, bundling with <a href="https://github.com/wessberg/rollup-plugin-ts" target="_blank" rel="noopener noreferrer">rollup-plugin-ts</a> works well to generate a <code>.d.ts</code> file. However, even with this method, the ability to generate <code>.map</code> files and the <code>chunking</code> feature is not available. Given that library projects are often bundled as part of JavaScript projects, I think these limitations are acceptable.</p>
<p>I use <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a> for barrel file generation and <a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a> and <a href="https://github.com/justkey007/tsc-alias" target="_blank" rel="noopener noreferrer">tsc-alias</a> for bundling. However, this method may not be suitable for monorepos consisting of multiple packages or if the <code>composite</code> option is set in <code>tsconfig</code>. Before introducing <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a> or <code>.d.ts</code> bundling tools to your ongoing library packages, it is important to test them and make sure they are suitable before applying them.</p>
<h3 class="anchor anchorWithStickyNavbar_awSM" id="default-export-export">default export, export<a href="#default-export-export" class="hash-link" aria-label="Direct link to default export, export" title="Direct link to default export, export">​</a></h3>
<p>There has been some <a href="https://github.com/airbnb/javascript/issues/1365" target="_blank" rel="noopener noreferrer">discussion</a> about the use of <code>default export</code> vs <code>export</code>, but it&#x27;s hard to conclude unequivocally that one is better. For example, <a href="https://github.com/airbnb/javascript#modules--prefer-default-export" target="_blank" rel="noopener noreferrer">eslint-config-airbnb</a> recommends using <code>default export</code>. However, when developing <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a> and using the TypeScript Compiler API, I noticed that all of the <code>default export</code>s were named <code>default</code>. Since all of the import statements in a barrel file are collected in one place, duplicate names can cause problems. The <code>default export</code> is similar to an anonymous export because it has the same name. If the original statement has a name, you can use the <code>alias</code> keyword to give it the original name, but since different <code>.d.ts</code> bundlers handle aliases differently, the result may not be what you intended.</p>
<p>Thus, <code>default export</code> can cause complicated syntax issues in library packages that need to be used by other projects. Because different bundling tools work differently, and because developers have different preferences on how to handle them, I believe that <code>default export</code> should only be used in components that cannot be handled by TypeScript, such as Vue and Svelte. In other cases, using <code>export</code> minimizes the chance of problems.</p>
<h2 class="anchor anchorWithStickyNavbar_awSM" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Library package projects are useful when developing. With <a href="http://npmjs.com/" target="_blank" rel="noopener noreferrer">npm</a>, there are tons of library packages available. I&#x27;ve been creating and using libraries out of necessity, and in doing so, I&#x27;ve felt the need to organize how I go about scaffolding my library package projects. There&#x27;s a lot of good material out there about setting up bundlers and overall scaffolding, but topics like Paths Re-Map and <code>.d.ts</code> bundling are relatively uninformed, so I&#x27;ve put together some thoughts on that. The following is by no means a definitive answer, but it&#x27;s the way I apply it when working on library projects.</p>
<ol>
<li>Automatically generate an barrel file using <a href="https://github.com/imjuni/ctix" target="_blank" rel="noopener noreferrer">ctix</a></li>
<li>Bundling <code>.d.ts</code> files using <a href="https://github.com/Swatinem/rollup-plugin-dts" target="_blank" rel="noopener noreferrer">rollup-plugin-dts</a> and <a href="https://github.com/justkey007/tsc-alias" target="_blank" rel="noopener noreferrer">tsc-alias</a></li>
<li>Bundling with <a href="https://esbuild.github.io/" target="_blank" rel="noopener noreferrer">esbuild</a></li>
<li>use <a href="https://vitest.dev/" target="_blank" rel="noopener noreferrer">vitest</a> or <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">jest</a> as a test runner<!-- -->
<ol>
<li>use <a href="https://www.npmjs.com/package/vite-tsconfig-paths" target="_blank" rel="noopener noreferrer">vite-tsconfig-paths</a> to pass <a href="https://kulshekhar.github.io/ts-jest/docs/getting-started/paths-mapping/" target="_blank" rel="noopener noreferrer">Paths Re-Map</a></li>
<li>use <a href="https://kulshekhar.github.io/ts-jest/" target="_blank" rel="noopener noreferrer">ts-jest</a> and set up <a href="https://kulshekhar.github.io/ts-jest/docs/getting-started/paths-mapping/" target="_blank" rel="noopener noreferrer">Paths Re-Map</a></li>
</ol>
</li>
</ol>
<p>I&#x27;ve uploaded the <a href="https://github.com/imjuni/typescript-lib-boilerplate" target="_blank" rel="noopener noreferrer">typescript-lib-boilerplate</a> repo.for your reference. How do you guys work when developing library projects? If you have any good tips, please let me know, thanks!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/imjuni/typescript/ctix"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ctix - barrel file generator using TypeScript Compiler API</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_eHnk thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#whats-the-problem" class="table-of-contents__link toc-highlight">What&#39;s the problem?</a><ul><li><a href="#barrel-file-edit-over-and-over-again" class="table-of-contents__link toc-highlight">Barrel file, edit over and over again</a></li><li><a href="#can-i-use-paths-re-maps" class="table-of-contents__link toc-highlight">Can I use paths re-maps?</a></li><li><a href="#bundling-for-dts" class="table-of-contents__link toc-highlight">bundling for <code>.d.ts</code></a></li></ul></li><li><a href="#how-can-we-solve-it" class="table-of-contents__link toc-highlight">How can we solve it?</a><ul><li><a href="#automatically-generate-a-barrel-file" class="table-of-contents__link toc-highlight">Automatically generate a barrel file</a></li><li><a href="#dts-bundling" class="table-of-contents__link toc-highlight"><code>.d.ts</code> bundling</a></li><li><a href="#default-export-export" class="table-of-contents__link toc-highlight">default export, export</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/imjuni/docs/index">About</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/imjuni" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mtdL"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>