"use strict";(self.webpackChunkimjuni_home=self.webpackChunkimjuni_home||[]).push([[7533],{3479:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var r=i(1527),n=i(6274);const s={sidebar_position:1,title:"ctix - barrel file generator using TypeScript Compiler API"},o=void 0,a={id:"typescript/ctix",title:"ctix - barrel file generator using TypeScript Compiler API",description:"Background",source:"@site/docs/typescript/ctix.md",sourceDirName:"typescript",slug:"/typescript/ctix",permalink:"/imjuni/typescript/ctix",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"ctix - barrel file generator using TypeScript Compiler API"},sidebar:"aboutSidebar",previous:{title:"Hive",permalink:"/imjuni/opensource/etc/hive/"},next:{title:"In-Depth guide for TypeScript Library Project",permalink:"/imjuni/typescript/library"}},l={},c=[{value:"Background",id:"background",level:2},{value:"Problems when developers write their own barrel files",id:"problems-when-developers-write-their-own-barrel-files",level:2},{value:"Automate barrel file writing with the TypeScript Compiler API",id:"automate-barrel-file-writing-with-the-typescript-compiler-api",level:2},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"background",children:"Background"}),"\n",(0,r.jsxs)(t.p,{children:["In the past, I've written barrel files for various open source projects and work-related libraries. ",(0,r.jsx)(t.a,{href:"https://basarat.gitbook.io/typescript/main-1/barrel",children:"Barrel files"})," are often used to simplify import statements, or to allow libraries to be exported to other projects. I've seen them in action recently, especially in the Next.js project, where they've been utilized to improve performance."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://basarat.gitbook.io/typescript/main-1/barrel",children:"TypeScript Deep Dive - barrel"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://vercel.com/blog/how-we-optimized-package-imports-in-next-js",children:"How we optimized package imports in Next.js"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"problems-when-developers-write-their-own-barrel-files",children:"Problems when developers write their own barrel files"}),"\n",(0,r.jsx)(t.p,{children:"At first, you'll probably write most of your barrel files by hand, but since it's a fairly repetitive task, you'll probably want to find a tool to automate it. There are a couple of tools to automatically write barrel files."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["CLI","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://github.com/bencoveney/barrelsby",children:"barrelsby"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://github.com/stolinski/barrelbot",children:"barrelbot"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://github.com/gajus/create-index",children:"create-index"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["IDE","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://marketplace.visualstudio.com/items?itemName=eliostruyf.vscode-typescript-exportallmodules",children:"VSCODE - TypeScript Barrel Generator"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://plugins.jetbrains.com/plugin/14990-barrels",children:"WebStorm - Barrels"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["These tools are awesome, but they mostly work based on directory traversal and filenames. While this works well in many cases, it has limitations in some situations. For example, ",(0,r.jsx)(t.a,{href:"https://github.com/airbnb/javascript",children:"eslint-config-airbnb"})," recommends writing a class or function in a single file, and thus prefers to use ",(0,r.jsx)(t.code,{children:"default export"}),". In the case of ",(0,r.jsx)(t.code,{children:"default export"}),", the filename and the name of the ",(0,r.jsx)(t.code,{children:"default export"})," statement may not match, but directory traversal and filename-based approaches cannot separate filenames from variable names."]}),"\n",(0,r.jsxs)(t.p,{children:["These tools also have the limitation of not being recognized for empty files or test cases. Test cases can be filtered out through the glob pattern, but recognizing empty files is a challenge. Furthermore, barrel files are a collection of multiple ",(0,r.jsx)(t.code,{children:"export"})," statements in one file, which can cause compilation errors if there are duplicate names. It is difficult to reliably filter out these duplicates with filename-based processing."]}),"\n",(0,r.jsx)(t.p,{children:"Considering these points, I came to the conclusion that while directory traversal and filename-based approaches are quick and easy, they may not be useful in complex projects. I recognized the need for a different approach."}),"\n",(0,r.jsx)(t.h2,{id:"automate-barrel-file-writing-with-the-typescript-compiler-api",children:"Automate barrel file writing with the TypeScript Compiler API"}),"\n",(0,r.jsxs)(t.p,{children:["At first, I tried to solve the problem with a directory traversal and filename-based approach. I developed and used ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/create-ts-index",children:"create-ts-index"})," for this purpose, but after experiencing the previously mentioned issues, I recognized the limitations of this approach. I decided that it needed to be improved, so I developed and used ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"}),". ctix utilizes the ",(0,r.jsx)(t.a,{href:"https://github.com/microsoft/TypeScript/wiki/Using-the-Compiler-API",children:"Typescript Compiler API"})," to write barrel files. This approach solved most of the problems I mentioned earlier."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"default export"})," statement can handle different filenames and variable names"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"// button.component.ts\n\nconst Button = () => {\n  return <button>test</button>;\n};\n\nButton.getInitialProps = () => { /* ... */ };\n\nexport default Button;\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The file is named ",(0,r.jsx)(t.code,{children:"button.component.ts"}),", but in the export statement it is named ",(0,r.jsx)(t.code,{children:"Button"}),". Since ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," uses the Typescript compiler API to get variable names, the above can be added to the barrel file without error."]}),"\n",(0,r.jsxs)(t.p,{children:["When there are multiple ",(0,r.jsx)(t.code,{children:"export statements"})," in a file, it is possible to exclude only some of them from the barrel file."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"export function dog() {\n  // ...\n}\n\n// @ctix-exclude-next\nexport function peach() {\n  // ...\n}\n\nexport function cat() {\n  // ...\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you look at the code above, you'll see that I've excluded ",(0,r.jsx)(t.code,{children:"peach"}),", which has a different personality, from the barrel file. In this case, the barrel file is written as shown below."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"export { dog, cat } from './animal';\n"})}),"\n",(0,r.jsxs)(t.p,{children:["In addition, ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," can write barrel files with filenames using module mode since version 2.1. Front-end component projects such as ",(0,r.jsx)(t.a,{href:"https://vuejs.org/",children:"Vue"})," and ",(0,r.jsx)(t.a,{href:"https://svelte.dev/",children:"Svelte"})," have a different syntax and cannot be parsed using the TypeScript compiler API, so typically Vue and Svelte components use filenames as names and are registered as modules in TypeScript as type files."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"declare module '*.vue' {\n  import Vue from 'vue';\n  export default Vue;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The above code is a type file written to make files with the ",(0,r.jsx)(t.code,{children:".vue"})," extension recognized as modules by Typescript. With this setup, Typescript cannot directly parse the contents of a ",(0,r.jsx)(t.code,{children:".vue"})," file, but it will recognize it as a module. ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," takes advantage of this, first writing barrel files for Vue components based on filenames and directory traversal."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"/// <reference path=\"../types/vue.d.ts\" />\n\nimport Button from './Button.vue';\nimport Accordion from './Accordion.vue';\n\nexport { Button, Accordion };\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Unfortunately, the reference setting with the triple slash in the first line must be handled by the developer. It can be passed using the ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix/blob/master/doc/OPTION_BUILD_MODULE.md",children:"directive option"}),". This will automatically add the TypeScript compiler API to the barrel file and affect the next barrel file writing operation, meaning that both actual TypeScript files and Vue components will be able to write barrel files. I've uploaded a working example to ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix/blob/master/example/type10",children:"example/type10"})," and a ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix/blob/master/example/type10/.ctirc",children:"configuration file"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Duplicate ",(0,r.jsx)(t.code,{children:"export statement"}),"s can also be better detected."]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"marvel.ts"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"export const ironman = 'ironman is awesome!'\n"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"avengers.ts"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"export const ironman = 'avengers assemble!'\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Because of the different file names, duplicate detection is difficult to do with filename and directory traversal, but it can be achieved using the Typescript compiler API. To prevent errors in situations like this, ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," excludes duplicate statements and outputs warning messages to help developers recognize errors."]}),"\n",(0,r.jsxs)(t.p,{children:["By using the TypeScript compiler API, it can correctly handle most of the ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix/blob/master/src/compilers/getExportedKind.ts",children:"export syntax"})," used by TypeScript, and it can write barrel files using actual code, as compared to the filename and directory traversal approach."]}),"\n",(0,r.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," is a tool that writes barrel files correctly in a variety of situations. It's designed to free developers from having to care about barrel files themselves, and offers a number of features including duplicate detection, exclusion of particular statements, and support for Vue and Svelte components. However, because it uses the TypeScript compiler API, it is slower than barrel file writing based on filenames and directory traversal. It also requires a tsconfig.json file to be provided for it to work correctly. To solve these problems, I've added the ability to generate a configuration file via an interactive prompt with the ",(0,r.jsx)(t.code,{children:"init"})," command, and improved performance by minimizing the scope of the TypeScript compiler API's project analysis."]}),"\n",(0,r.jsxs)(t.p,{children:["With ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"}),", you can automate the hassle of writing barrel files. Give it a try and let us know what you think so for us to make ",(0,r.jsx)(t.a,{href:"https://github.com/imjuni/ctix",children:"ctix"})," even better!"]})]})}function d(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);